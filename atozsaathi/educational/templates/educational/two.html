<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Online Exam</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f4;
      padding: 20px;
    }

    .exam-container {
      max-width: 800px;
      margin: auto;
      background: #fff;
      padding: 2rem;
      border-radius: 10px;
      box-shadow: 0 0 20px rgba(0,0,0,0.1);
    }

    .timer {
      font-size: 1.2rem;
      text-align: right;
      margin-bottom: 10px;
    }

    .question-status-bar {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .question-status {
      width: 30px;
      height: 30px;
      text-align: center;
      line-height: 30px;
      border-radius: 50%;
      background-color: red;
      color: #fff;
      font-weight: bold;
    }

    .green {
      background-color: green;
    }

    .orange {
      background-color: orange;
    }

    .question {
      display: none;
    }

    .question.active {
      display: block;
    }

    .options label {
      display: block;
      margin: 8px 0;
    }

    .navigation {
      margin-top: 20px;
      display: flex;
      justify-content: space-between;
    }

    button {
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1rem;
    }

    #submit-button {
      background-color: #e74c3c;
      color: white;
    }

    #prev-button,
    #next-button {
      background-color: #3498db;
      color: white;
    }
  </style>
</head>
<body>
<div class="exam-container">
  <div class="timer">Time Left: <span id="time-left">0:00</span></div>

  <div class="question-status-bar">
    <div class="question-status">1</div>
    <div class="question-status">2</div>
    <div class="question-status">3</div>
  </div>

  <div class="question active" data-index="0">
    <h3>Question 1: What is 2 + 2?</h3>
    <div class="options">
      <label><input type="radio" name="q-0" class="option" value="0"> 3</label>
      <label><input type="radio" name="q-0" class="option" value="1"> 4</label>
      <label><input type="radio" name="q-0" class="option" value="2"> 5</label>
    </div>
  </div>

  <div class="question" data-index="1">
    <h3>Question 2: Capital of France?</h3>
    <div class="options">
      <label><input type="radio" name="q-1" class="option" value="0"> Berlin</label>
      <label><input type="radio" name="q-1" class="option" value="1"> Madrid</label>
      <label><input type="radio" name="q-1" class="option" value="2"> Paris</label>
    </div>
  </div>

  <div class="question" data-index="2">
    <h3>Question 3: Largest planet in our solar system?</h3>
    <div class="options">
      <label><input type="radio" name="q-2" class="option" value="0"> Earth</label>
      <label><input type="radio" name="q-2" class="option" value="1"> Jupiter</label>
      <label><input type="radio" name="q-2" class="option" value="2"> Mars</label>
    </div>
  </div>

  <div class="navigation">
    <button id="prev-button" style="display: none;">Previous</button>
    <button id="next-button">Next</button>
    <button id="submit-button">Submit</button>
  </div>
</div>

<script>
  // Mock exam data
  const examData = {
    _id: "demoExam123",
    duration: 1 // in minutes
  };

  let currentQuestionIndex = 0;
  let timeLeft = 0;
  let answers = [];
  let visitedQuestions = new Set();
  let examSubmitted = false;

  document.addEventListener('DOMContentLoaded', function () {
    const questions = document.querySelectorAll('.question');
    const timeLeftElement = document.getElementById('time-left');
    const questionStatusElements = document.querySelectorAll('.question-status');

    // Set initial color to red
    questionStatusElements.forEach(el => el.classList.add('red'));

    const duration = examData.duration * 60;
    timeLeft = duration;
    updateTimer();

    const timerInterval = setInterval(() => {
      if (timeLeft <= 0) {
        clearInterval(timerInterval);
        handleSubmit();
      } else {
        timeLeft--;
        updateTimer();
      }
    }, 1000);

    function updateTimer() {
      const minutes = Math.floor(timeLeft / 60);
      const seconds = timeLeft % 60;
      timeLeftElement.textContent = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
    }

    function updateQuestionDisplay() {
      questions.forEach((q, i) => {
        q.classList.toggle('active', i === currentQuestionIndex);

        if (answers[i] !== undefined) {
          questionStatusElements[i].className = 'question-status green';
        } else if (visitedQuestions.has(i)) {
          questionStatusElements[i].className = 'question-status orange';
        } else {
          questionStatusElements[i].className = 'question-status red';
        }
      });

      document.getElementById('prev-button').style.display = currentQuestionIndex > 0 ? 'inline-block' : 'none';
      document.getElementById('next-button').style.display = currentQuestionIndex < questions.length - 1 ? 'inline-block' : 'none';
    }

    document.getElementById('prev-button').addEventListener('click', () => {
      visitedQuestions.add(currentQuestionIndex);
      currentQuestionIndex = Math.max(currentQuestionIndex - 1, 0);
      updateQuestionDisplay();
    });

    document.getElementById('next-button').addEventListener('click', () => {
      visitedQuestions.add(currentQuestionIndex);
      currentQuestionIndex = Math.min(currentQuestionIndex + 1, questions.length - 1);
      updateQuestionDisplay();
    });

    document.querySelectorAll('.option').forEach(option => {
      option.addEventListener('click', (event) => {
        const qIndex = parseInt(event.target.name.split('-')[1]);
        answers[qIndex] = parseInt(event.target.value);
        visitedQuestions.add(qIndex);
        updateQuestionDisplay();
      });
    });

    document.getElementById('submit-button').addEventListener('click', handleSubmit);

    function handleSubmit() {
      if (examSubmitted) return;
      examSubmitted = true;

      console.log('Submitting Exam ID:', examData._id);
      console.log('Answers:', answers);

      // Mock submission
      alert('Exam Submitted!\nAnswers: ' + JSON.stringify(answers));
      // You can redirect or fetch here
      // window.location.href = `/exam/${examData._id}/result`;
    }

    updateQuestionDisplay();
  });
</script>
</body>
</html>
